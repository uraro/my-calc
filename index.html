<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>究極の電卓</title>
  <style>
    body { margin: 0; font-family: sans-serif; height: 100dvh; display: flex; flex-direction: column; background: #fff; }
    #display-area { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; }
    /* 履歴：文字を大きく、太く */
    .history-row { font-size: 36px; font-weight: bold; padding: 10px 0; border-bottom: 1px solid #eee; color: #333; }
    /* 入力中：もっと大きく */
    #current-line { font-size: 48px; font-weight: bold; padding: 20px 0; color: #3B82C4; min-height: 60px; }
    #keypad { display: grid; grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(5, 1fr); height: 50dvh; background: #ccc; gap: 1px; }
    button { border: none; background: #fff; font-size: 30px; font-weight: bold; cursor: pointer; -webkit-tap-highlight-color: transparent; }
    button:active { background: #eee; }
    .op { background: #3B82C4; color: #fff; font-size: 36px; }
    .ac { background: #f9f9f9; font-size: 24px; }
  </style>
</head>
<body>
  <div id="display-area">
    <div id="history-box"></div>
    <div id="current-line"></div>
  </div>
  <div id="keypad">
    <button onclick="doAC()" class="ac">AC</button>
    <button onclick="doDel()" class="ac">⌫</button>
    <button style="background:#f9f9f9"></button>
    <button onclick="addOp('/')" class="op">÷</button>
    <button onclick="addNum('7')">7</button><button onclick="addNum('8')">8</button><button onclick="addNum('9')">9</button>
    <button onclick="addOp('*')" class="op">×</button>
    <button onclick="addNum('4')">4</button><button onclick="addNum('5')">5</button><button onclick="addNum('6')">6</button>
    <button onclick="addOp('-')" class="op">-</button>
    <button onclick="addNum('1')">1</button><button onclick="addNum('2')">2</button><button onclick="addNum('3')">3</button>
    <button onclick="addOp('+')" class="op">+</button>
    <button onclick="addNum('0')">0</button><button onclick="addNum('00')">00</button><button onclick="addNum('.')">.</button>
    <button onclick="doCalc()" class="op">=</button>
  </div>

  <script>
    let rawFormula = "";
    let displayFormula = "";
    const historyBox = document.getElementById('history-box');
    const currentLine = document.getElementById('current-line');
    const displayArea = document.getElementById('display-area');

    function u() {
      currentLine.innerText = displayFormula || "0";
      displayArea.scrollTop = displayArea.scrollHeight;
    }
    function addNum(n) {
      rawFormula += n;
      displayFormula += n;
      u();
    }
    function addOp(op) {
      if(!rawFormula || "+-*/".includes(rawFormula.slice(-1))) return;
      rawFormula += op;
      displayFormula += (op=='*'?'×':op=='/'?'÷':op);
      u();
    }
    function doAC() {
      rawFormula = ""; displayFormula = ""; historyBox.innerHTML = ""; u();
    }
    function doDel() {
      rawFormula = rawFormula.slice(0, -1);
      displayFormula = displayFormula.slice(0, -1);
      u();
    }
    function doCalc() {
      if(!rawFormula || "+-*/".includes(rawFormula.slice(-1))) return;
      try {
        let result = eval(rawFormula);
        let row = document.createElement('div');
        row.className = 'history-row';
        row.innerText = displayFormula + " = " + result.toLocaleString();
        historyBox.appendChild(row);
        rawFormula = ""; displayFormula = ""; u();
      } catch(e) { alert("計算エラー"); }
    }
    u();
  </script>
</body>
</html>
